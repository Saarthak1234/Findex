<!DOCTYPE html>
<html>
<head>
    <title>External Search Overlay Test</title>
    <style>
        body { margin: 0; padding: 20px; font-family: Arial, sans-serif; }
        .test-container { max-width: 400px; margin: 0 auto; }
        .test-button { padding: 10px; margin: 5px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
        .test-button:hover { background: #0056b3; }
        .demo-text { margin: 20px 0; padding: 15px; background: #f8f9fa; border-radius: 4px; }
        .status { margin: 10px 0; padding: 10px; background: #e9ecef; border-radius: 4px; }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>External Search Overlay Test</h1>
        <p>This page tests the external search overlay functionality.</p>
        
        <div class="status" id="status">
            Status: Ready to test
        </div>
        
        <button class="test-button" onclick="openSidebar()">Open Sidebar</button>
        <button class="test-button" onclick="testSearch()">Test Search Overlay</button>
        <button class="test-button" onclick="testThemeChange()">Test Theme Change</button>
        
        <div class="demo-text">
            <h3>Demo Transcript</h3>
            <p>This is a sample transcript for testing the search functionality. You can search for words like "test", "search", "functionality", "demo", "sample", etc.</p>
            <p>The external search overlay should appear as a separate window when you click the search button in the sidebar, and it should support all the theme variations.</p>
        </div>
    </div>
    
    <script>
        let sidebarWindow = null;
        let searchOverlayWindow = null;
        
        function updateStatus(message) {
            document.getElementById('status').textContent = 'Status: ' + message;
        }
        
        function openSidebar() {
            sidebarWindow = window.open('sidebar/sidebar.html', 'sidebar', 'width=400,height=600,right=0,top=0');
            
            // Simulate video data with transcript after a short delay
            setTimeout(() => {
                if (sidebarWindow && !sidebarWindow.closed) {
                    sidebarWindow.postMessage({
                        type: 'setVideoData',
                        data: {
                            title: 'Test Video',
                            uploader: 'Test Channel',
                            duration: 120,
                            view_count: 1000,
                            transcript: 'This is a sample transcript for testing the search functionality. You can search for words like test, search, functionality, demo, sample, and other terms. The external search overlay should work with all theme variations and provide a smooth user experience.'
                        }
                    }, '*');
                    updateStatus('Sidebar opened with video data');
                }
            }, 1000);
        }
        
        function testSearch() {
            // Open sidebar and trigger search
            if (!sidebarWindow || sidebarWindow.closed) {
                openSidebar();
                setTimeout(() => testSearch(), 1500);
                return;
            }
            
            // Simulate clicking the search button in sidebar
            updateStatus('Opening search overlay...');
            
            // The sidebar will handle opening the search overlay
            // We can also directly open it for testing
            searchOverlayWindow = window.open('search-overlay/search-overlay.html', 'searchOverlay', 'width=320,height=300,left=100,top=100,resizable=no,scrollbars=no,toolbar=no,menubar=no,location=no,status=no');
            
            setTimeout(() => {
                if (searchOverlayWindow && !searchOverlayWindow.closed) {
                    searchOverlayWindow.postMessage({
                        type: 'setTheme',
                        theme: 'default'
                    }, '*');
                    
                    searchOverlayWindow.postMessage({
                        type: 'setVideoData',
                        data: {
                            title: 'Test Video',
                            uploader: 'Test Channel',
                            duration: 120,
                            view_count: 1000,
                            transcript: 'This is a sample transcript for testing the search functionality. You can search for words like test, search, functionality, demo, sample, and other terms. The external search overlay should work with all theme variations and provide a smooth user experience.'
                        }
                    }, '*');
                    
                    searchOverlayWindow.postMessage({
                        type: 'openSearch'
                    }, '*');
                    
                    updateStatus('Search overlay opened');
                }
            }, 100);
        }
        
        function testThemeChange() {
            if (!searchOverlayWindow || searchOverlayWindow.closed) {
                updateStatus('Please open search overlay first');
                return;
            }
            
            const themes = ['default', 'xp', 'macos', 'neobrutal', 'nintendo', 'orange', 'orangeDark', 'blueLight', 'blueDark'];
            const randomTheme = themes[Math.floor(Math.random() * themes.length)];
            
            searchOverlayWindow.postMessage({
                type: 'setTheme',
                theme: randomTheme
            }, '*');
            
            updateStatus('Theme changed to: ' + randomTheme);
        }
        
        // Listen for messages from search overlay
        window.addEventListener('message', (event) => {
            const { type, data } = event.data;
            
            switch (type) {
                case 'highlightSearchResult':
                    updateStatus(`Search result highlighted at position ${data.position} for term "${data.searchTerm}"`);
                    break;
                    
                case 'searchOverlayClosed':
                    updateStatus('Search overlay closed');
                    searchOverlayWindow = null;
                    break;
            }
        });
    </script>
</body>
</html> 