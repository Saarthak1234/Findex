<!DOCTYPE html>
<html>
<head>
    <title>Find Toolbar Test</title>
    <style>
        body { margin: 0; padding: 20px; font-family: Arial, sans-serif; }
        .test-container { max-width: 400px; margin: 0 auto; }
        .test-button { padding: 10px; margin: 5px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
        .test-button:hover { background: #0056b3; }
        .demo-text { margin: 20px 0; padding: 15px; background: #f8f9fa; border-radius: 4px; }
        .status { margin: 10px 0; padding: 10px; background: #e9ecef; border-radius: 4px; }
        .instructions { margin: 20px 0; padding: 15px; background: #fff3cd; border: 1px solid #ffeaa7; border-radius: 4px; }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>Find Toolbar Test</h1>
        <p>This page tests the find toolbar functionality that mimics browser Ctrl+F behavior.</p>
        
        <div class="status" id="status">
            Status: Ready to test
        </div>
        
        <div class="instructions">
            <h3>How to Test:</h3>
            <ul>
                <li><strong>Ctrl+F</strong>: Opens the find toolbar (works globally)</li>
                <li><strong>Search Button</strong>: Opens find toolbar from sidebar</li>
                <li><strong>Enter</strong>: Next result</li>
                <li><strong>Shift+Enter</strong>: Previous result</li>
                <li><strong>Escape</strong>: Close toolbar</li>
            </ul>
        </div>
        
        <button class="test-button" onclick="openSidebar()">Open Sidebar</button>
        <button class="test-button" onclick="testFindToolbar()">Test Find Toolbar</button>
        <button class="test-button" onclick="testCtrlF()">Test Ctrl+F</button>
        <button class="test-button" onclick="testThemeChange()">Test Theme Change</button>
        
        <div class="demo-text">
            <h3>Demo Transcript</h3>
            <p>This is a sample transcript for testing the find functionality. You can search for words like "test", "find", "functionality", "demo", "sample", etc.</p>
            <p>The find toolbar should appear as a compact bar at the top when you press Ctrl+F or click the search button, similar to browser find functionality.</p>
        </div>
    </div>
    
    <script>
        let sidebarWindow = null;
        let findToolbarWindow = null;
        
        function updateStatus(message) {
            document.getElementById('status').textContent = 'Status: ' + message;
        }
        
        function openSidebar() {
            sidebarWindow = window.open('sidebar/sidebar.html', 'sidebar', 'width=400,height=600,right=0,top=0');
            
            // Simulate video data with transcript after a short delay
            setTimeout(() => {
                if (sidebarWindow && !sidebarWindow.closed) {
                    sidebarWindow.postMessage({
                        type: 'setVideoData',
                        data: {
                            title: 'Test Video',
                            uploader: 'Test Channel',
                            duration: 120,
                            view_count: 1000,
                            transcript: 'This is a sample transcript for testing the find functionality. You can search for words like test, find, functionality, demo, sample, and other terms. The find toolbar should work with all theme variations and provide a smooth user experience similar to browser find functionality.'
                        }
                    }, '*');
                    updateStatus('Sidebar opened with video data');
                }
            }, 1000);
        }
        
        function testFindToolbar() {
            // Open sidebar and trigger find toolbar
            if (!sidebarWindow || sidebarWindow.closed) {
                openSidebar();
                setTimeout(() => testFindToolbar(), 1500);
                return;
            }
            
            updateStatus('Opening find toolbar...');
            
            // Directly open find toolbar for testing
            findToolbarWindow = window.open('find-toolbar/find-toolbar.html', 'findToolbar', 'width=800,height=50,left=100,top=100,resizable=no,scrollbars=no,toolbar=no,menubar=no,location=no,status=no');
            
            setTimeout(() => {
                if (findToolbarWindow && !findToolbarWindow.closed) {
                    findToolbarWindow.postMessage({
                        type: 'setTheme',
                        theme: 'default'
                    }, '*');
                    
                    findToolbarWindow.postMessage({
                        type: 'setVideoData',
                        data: {
                            title: 'Test Video',
                            uploader: 'Test Channel',
                            duration: 120,
                            view_count: 1000,
                            transcript: 'This is a sample transcript for testing the find functionality. You can search for words like test, find, functionality, demo, sample, and other terms. The find toolbar should work with all theme variations and provide a smooth user experience similar to browser find functionality.'
                        }
                    }, '*');
                    
                    findToolbarWindow.postMessage({
                        type: 'openFind'
                    }, '*');
                    
                    updateStatus('Find toolbar opened');
                }
            }, 100);
        }
        
        function testCtrlF() {
            if (!findToolbarWindow || findToolbarWindow.closed) {
                testFindToolbar();
                setTimeout(() => testCtrlF(), 500);
                return;
            }
            
            // Simulate Ctrl+F in the find toolbar window
            findToolbarWindow.postMessage({
                type: 'simulateCtrlF'
            }, '*');
            
            updateStatus('Ctrl+F simulated in find toolbar');
        }
        
        function testThemeChange() {
            if (!findToolbarWindow || findToolbarWindow.closed) {
                updateStatus('Please open find toolbar first');
                return;
            }
            
            const themes = ['default', 'xp', 'macos', 'neobrutal', 'nintendo', 'orange', 'orangeDark', 'blueLight', 'blueDark'];
            const randomTheme = themes[Math.floor(Math.random() * themes.length)];
            
            findToolbarWindow.postMessage({
                type: 'setTheme',
                theme: randomTheme
            }, '*');
            
            updateStatus('Theme changed to: ' + randomTheme);
        }
        
        // Listen for messages from find toolbar
        window.addEventListener('message', (event) => {
            const { type, data } = event.data;
            
            switch (type) {
                case 'highlightSearchResult':
                    updateStatus(`Search result highlighted at position ${data.position} for term "${data.searchTerm}"`);
                    break;
                    
                case 'findToolbarOpened':
                    updateStatus('Find toolbar opened');
                    break;
                    
                case 'findToolbarClosed':
                    updateStatus('Find toolbar closed');
                    findToolbarWindow = null;
                    break;
            }
        });
        
        // Add global Ctrl+F listener for testing
        document.addEventListener('keydown', (e) => {
            if (e.ctrlKey && e.key === 'f') {
                e.preventDefault();
                updateStatus('Ctrl+F pressed globally - opening find toolbar');
                testFindToolbar();
            }
        });
    </script>
</body>
</html> 